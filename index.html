<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéµ R√°dio Supermercado do Louro</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:system-ui,-apple-system,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;min-height:100vh;display:flex;align-items:center;justify-content:center;overflow-x:hidden}
        .container{background:rgba(255,255,255,.1);backdrop-filter:blur(15px);border-radius:25px;padding:30px;box-shadow:0 20px 40px rgba(0,0,0,.4);border:1px solid rgba(255,255,255,.2);max-width:480px;width:90%;text-align:center;animation:fadeIn .6s ease-out}
        @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
        .logo{font-size:2.2rem;font-weight:800;margin-bottom:5px;text-shadow:2px 2px 4px rgba(0,0,0,.6)}
        .subtitle{opacity:.85;margin-bottom:25px;font-size:1rem}
        .cover{width:180px;height:180px;border-radius:20px;margin:0 auto 20px;background:linear-gradient(45deg,#ff6b6b,#4ecdc4);display:flex;align-items:center;justify-content:center;font-size:3.5rem;box-shadow:0 15px 35px rgba(0,0,0,.3);transition:all .3s ease;cursor:pointer}
        .cover:hover{transform:scale(1.02)}
        .cover.pulse{animation:pulse 1.5s infinite}
        @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
        .info{margin:15px 0}
        .title{font-size:1.2rem;font-weight:700;margin-bottom:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .artist{opacity:.8;font-size:.9rem}
        .progress{width:100%;height:3px;background:rgba(255,255,255,.3);border-radius:3px;margin:15px 0;overflow:hidden}
        .progress-fill{height:100%;background:linear-gradient(90deg,#4ecdc4,#44a08d);width:0%;transition:width .1s linear}
        .controls{display:flex;align-items:center;justify-content:center;gap:20px;margin:20px 0}
        .btn{border:none;border-radius:50%;background:linear-gradient(45deg,#ff6b6b,#4ecdc4);color:#fff;cursor:pointer;transition:all .2s ease;box-shadow:0 8px 15px rgba(0,0,0,.3)}
        .play-btn{width:55px;height:55px;font-size:1.4rem}
        .btn:hover{transform:scale(1.05);box-shadow:0 12px 25px rgba(0,0,0,.4)}
        .btn:active{transform:scale(.95)}
        .volume{display:flex;align-items:center;gap:8px}
        .slider{width:80px;height:4px;border-radius:4px;background:rgba(255,255,255,.3);outline:none;cursor:pointer;-webkit-appearance:none}
        .slider::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;border-radius:50%;background:#ff6b6b;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,.3)}
        .admin-btn{position:fixed;top:15px;right:15px;background:rgba(255,255,255,.2);border:none;color:#fff;padding:8px 12px;border-radius:15px;cursor:pointer;font-size:.8rem;transition:all .3s ease;backdrop-filter:blur(10px)}
        .admin-btn:hover{background:rgba(255,255,255,.3);transform:scale(1.05)}
        .panel{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.95);z-index:1000;overflow-y:auto;padding:15px}
        .panel-content{background:rgba(255,255,255,.1);backdrop-filter:blur(15px);border-radius:20px;padding:25px;max-width:900px;margin:0 auto;border:1px solid rgba(255,255,255,.2)}
        .panel-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px;flex-wrap:wrap}
        .close-btn{background:#ff4757;border:none;color:#fff;padding:8px 15px;border-radius:8px;cursor:pointer;font-size:.9rem}
        .login{background:rgba(255,255,255,.1);border-radius:15px;padding:25px;margin:15px auto;max-width:350px}
        .input{width:100%;padding:12px;border:none;border-radius:8px;background:rgba(255,255,255,.2);color:#fff;font-size:.9rem;margin-bottom:15px}
        .input::placeholder{color:rgba(255,255,255,.7)}
        .login-btn{width:100%;padding:12px;border:none;border-radius:8px;background:linear-gradient(45deg,#4ecdc4,#44a08d);color:#fff;font-size:.95rem;cursor:pointer}
        .section{background:rgba(255,255,255,.08);border-radius:12px;padding:18px;margin-bottom:15px}
        .section h3{margin-bottom:12px;color:#4ecdc4;font-size:1.1rem}
        .file-input{width:100%;padding:8px;border:2px dashed rgba(255,255,255,.3);border-radius:8px;background:rgba(255,255,255,.1);color:#fff;margin-bottom:8px;cursor:pointer;font-size:.85rem}
        .upload-btn{background:linear-gradient(45deg,#4ecdc4,#44a08d);border:none;color:#fff;padding:8px 15px;border-radius:8px;cursor:pointer;font-size:.9rem;width:100%;margin-bottom:10px}
        .albums{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px;margin:12px 0}
        .album{background:rgba(255,255,255,.1);border-radius:8px;padding:12px;text-align:center;cursor:pointer;transition:all .2s ease;font-size:.85rem}
        .album:hover{background:rgba(255,255,255,.2)}
        .album.active{background:linear-gradient(45deg,#4ecdc4,#44a08d)}
        .files{max-height:150px;overflow-y:auto;background:rgba(0,0,0,.3);border-radius:8px;padding:8px;margin-top:8px}
        .file{display:flex;justify-content:space-between;align-items:center;padding:6px;border-bottom:1px solid rgba(255,255,255,.1);font-size:.8rem}
        .del-btn{background:#ff4757;border:none;color:#fff;padding:3px 8px;border-radius:4px;cursor:pointer;font-size:.7rem}
        .stats{background:rgba(255,255,255,.08);border-radius:12px;padding:18px;margin-top:15px}
        .stats h3{color:#ff6b6b;margin-bottom:12px;font-size:1.1rem}
        .stat{display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid rgba(255,255,255,.1);font-size:.85rem}
        .backup{display:flex;gap:8px;margin-top:12px}
        .backup button{flex:1;padding:8px;border:none;border-radius:6px;color:#fff;cursor:pointer;font-size:.8rem}
        .export{background:#28a745}
        .import{background:#17a2b8}
        .reset{background:#dc3545}
        @media(max-width:768px){
            .container{padding:20px;margin:15px}
            .panel-content{padding:15px;margin:10px}
            .albums{grid-template-columns:repeat(2,1fr)}
            .panel-header{flex-direction:column;gap:10px}
        }
        .loading{opacity:.6;pointer-events:none}
        .success{background:#28a745!important}
        .error{background:#dc3545!important}
    </style>
</head>
<body>
    <button class="admin-btn" onclick="toggleAdmin()">‚öôÔ∏è</button>
    
    <div class="container">
        <div class="logo">üéµ R√°dio Supermercado</div>
        <div class="subtitle">do Louro</div>
        
        <div class="cover" id="cover" onclick="togglePlay()">üéµ</div>
        
        <div class="info">
            <div class="title" id="title">Carregando...</div>
            <div class="artist" id="artist">Prepare-se para uma experi√™ncia √∫nica</div>
        </div>
        
        <div class="progress">
            <div class="progress-fill" id="progress"></div>
        </div>
        
        <div class="controls">
            <button class="btn play-btn" id="playBtn" onclick="togglePlay()">‚ñ∂Ô∏è</button>
            <div class="volume">
                <span>üîä</span>
                <input type="range" class="slider" id="volume" min="0" max="100" value="70">
            </div>
        </div>
    </div>

    <div class="panel" id="panel">
        <div id="loginForm" class="login">
            <h2 style="text-align:center;margin-bottom:15px">üîê Admin</h2>
            <input type="password" class="input" id="pass" placeholder="Senha">
            <button class="login-btn" onclick="login()">Entrar</button>
        </div>

        <div id="adminContent" class="panel-content" style="display:none">
            <div class="panel-header">
                <h2>üõ†Ô∏è Painel Admin</h2>
                <button class="close-btn" onclick="closeAdmin()">‚úï</button>
            </div>

            <div class="section">
                <h3>üéµ M√∫sicas</h3>
                <input type="file" class="file-input" id="musicFiles" accept=".mp3" multiple>
                <button class="upload-btn" onclick="upload('music')">Upload</button>
                <div class="files" id="musicList"></div>
            </div>

            <div class="section">
                <h3>üïê Hora Certa</h3>
                <input type="file" class="file-input" id="timeFiles" accept=".mp3" multiple>
                <button class="upload-btn" onclick="upload('time')">Upload</button>
                <div class="files" id="timeList"></div>
            </div>

            <div class="section">
                <h3>üì¢ Avisos</h3>
                <input type="file" class="file-input" id="adFiles" accept=".mp3" multiple>
                <button class="upload-btn" onclick="upload('ads')">Upload</button>
                <div class="files" id="adsList"></div>
            </div>

            <div class="section">
                <h3>üéä √Ålbuns Tem√°ticos</h3>
                <div class="albums">
                    <div class="album" data-album="natal" onclick="setAlbum('natal')">üéÑ Natal</div>
                    <div class="album" data-album="pascoa" onclick="setAlbum('pascoa')">üê∞ P√°scoa</div>
                    <div class="album" data-album="saojoao" onclick="setAlbum('saojoao')">üé™ S√£o Jo√£o</div>
                    <div class="album" data-album="none" onclick="setAlbum('none')">‚ùå Nenhum</div>
                </div>
                <input type="file" class="file-input" id="albumFiles" accept=".mp3" multiple>
                <button class="upload-btn" onclick="uploadAlbum()">Upload √Ålbum</button>
                <div class="files" id="albumList"></div>
            </div>

            <div class="stats">
                <h3>üìä Estat√≠sticas</h3>
                <div id="statsContent"></div>
                <div class="backup">
                    <button class="export" onclick="exportData()">üì§ Exportar</button>
                    <button class="import" onclick="document.getElementById('importFile').click()">üì• Importar</button>
                    <button class="reset" onclick="resetStats()">üóëÔ∏è Reset</button>
                </div>
                <input type="file" id="importFile" accept=".json" onchange="importData(event)" style="display:none">
            </div>
        </div>
    </div>

    <audio id="audio" preload="auto"></audio>

    <script>
        // Configura√ß√µes
        const CLOUD = {
            name: 'dygbrcrr6',
            preset: 'radio_preset',
            url: 'https://api.cloudinary.com/v1_1/dygbrcrr6/video/upload'
        };

        // Estado global compacto
        let state = {
            playlist: [],
            index: 0,
            playing: false,
            count: 0,
            album: localStorage.getItem('album') || 'none',
            files: {
                music: JSON.parse(localStorage.getItem('music') || '[]'),
                time: JSON.parse(localStorage.getItem('time') || '[]'),
                ads: JSON.parse(localStorage.getItem('ads') || '[]'),
                natal: JSON.parse(localStorage.getItem('natal') || '[]'),
                pascoa: JSON.parse(localStorage.getItem('pascoa') || '[]'),
                saojoao: JSON.parse(localStorage.getItem('saojoao') || '[]')
            },
            stats: JSON.parse(localStorage.getItem('stats') || '{}')
        };

        // Elementos DOM
        const el = {
            audio: document.getElementById('audio'),
            play: document.getElementById('playBtn'),
            volume: document.getElementById('volume'),
            title: document.getElementById('title'),
            artist: document.getElementById('artist'),
            cover: document.getElementById('cover'),
            progress: document.getElementById('progress'),
            panel: document.getElementById('panel')
        };

        // Inicializa√ß√£o otimizada
        function init() {
            setupAudio();
            buildPlaylist();
            updateUI();
            updateAlbums();
            updateLists();
            updateStats();
            
            // Auto-start ap√≥s 1s
            setTimeout(() => {
                if (state.playlist.length) playTrack();
            }, 1000);
        }

        function setupAudio() {
            el.audio.volume = el.volume.value / 100;
            
            el.volume.oninput = e => el.audio.volume = e.target.value / 100;
            el.audio.ontimeupdate = () => {
                if (el.audio.duration) {
                    const pct = (el.audio.currentTime / el.audio.duration) * 100;
                    el.progress.style.width = pct + '%';
                }
            };
            el.audio.onended = nextTrack;
            el.audio.onerror = nextTrack;
            el.audio.onplay = () => {
                state.playing = true;
                el.play.textContent = '‚è∏Ô∏è';
                el.cover.classList.add('pulse');
            };
            el.audio.onpause = () => {
                state.playing = false;
                el.play.textContent = '‚ñ∂Ô∏è';
                el.cover.classList.remove('pulse');
            };
        }

        // Sistema de playlist ultra-otimizado
        function buildPlaylist() {
            state.playlist = [];
            const music = [...state.files.music];
            if (state.album !== 'none') music.push(...state.files[state.album]);
            
            if (!music.length) {
                state.playlist = [{
                    type: 'music',
                    title: 'Exemplo',
                    artist: 'Sistema',
                    url: 'https://res.cloudinary.com/dygbrcrr6/video/upload/v1749781508/Leonardo-Nao-Aprendi-A-Dizer-Adeus_xrmdjf.mp3'
                }];
                return;
            }

            // Embaralhar e construir playlist inteligente
            music.sort(() => Math.random() - 0.5);
            
            music.forEach((track, i) => {
                state.playlist.push({
                    type: 'music',
                    title: track.name || 'M√∫sica',
                    artist: 'Supermercado do Louro',
                    url: track.url
                });

                // Hora certa a cada 3 m√∫sicas
                if ((i + 1) % 3 === 0 && state.files.time.length) {
                    const time = state.files.time[Math.floor(Math.random() * state.files.time.length)];
                    state.playlist.push({
                        type: 'time',
                        title: 'Hora Certa',
                        artist: 'Informativo',
                        url: time.url
                    });
                }

                // Avisos a cada 6 m√∫sicas
                if ((i + 1) % 6 === 0 && state.files.ads.length) {
                    const ad = state.files.ads[Math.floor(Math.random() * state.files.ads.length)];
                    state.playlist.push({
                        type: 'ads',
                        title: 'Aviso',
                        artist: 'Administra√ß√£o',
                        url: ad.url
                    });
                }
            });
        }

        function togglePlay() {
            if (state.playing) {
                el.audio.pause();
            } else {
                if (!state.playlist.length) buildPlaylist();
                if (state.index >= state.playlist.length) state.index = 0;
                playTrack();
            }
        }

        function playTrack() {
            if (!state.playlist.length) return;
            
            const track = state.playlist[state.index];
            el.audio.src = track.url;
            el.audio.play().catch(() => nextTrack());
            updateUI();
            recordPlay(track);
        }

        function nextTrack() {
            state.index++;
            if (state.index >= state.playlist.length) {
                buildPlaylist();
                state.index = 0;
            }
            playTrack();
        }

        function updateUI() {
            if (!state.playlist.length) return;
            
            const track = state.playlist[state.index];
            el.title.textContent = track.title;
            el.artist.textContent = track.artist;

            // Visual por tipo
            if (track.type === 'time') {
                el.cover.style.background = 'linear-gradient(45deg,#ffa726,#ff9800)';
                el.cover.textContent = 'üïê';
            } else if (track.type === 'ads') {
                el.cover.style.background = 'linear-gradient(45deg,#ef5350,#e53935)';
                el.cover.textContent = 'üì¢';
            } else {
                el.cover.style.background = 'linear-gradient(45deg,#ff6b6b,#4ecdc4)';
                el.cover.textContent = 'üéµ';
            }
        }

        function recordPlay(track) {
            if (track.type === 'music') {
                const key = `${track.title} - ${track.artist}`;
                state.stats[key] = (state.stats[key] || 0) + 1;
                localStorage.setItem('stats', JSON.stringify(state.stats));
                updateStats();
            }
        }

        function updateStats() {
            const container = document.getElementById('statsContent');
            container.innerHTML = '';
            Object.entries(state.stats)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 8)
                .forEach(([track, count]) => {
                    const div = document.createElement('div');
                    div.className = 'stat';
                    div.innerHTML = `<span>${track}</span><span>${count}x</span>`;
                    container.appendChild(div);
                });
        }

        // Admin functions - ultra compactas
        function toggleAdmin() {
            el.panel.style.display = 'block';
        }

        function closeAdmin() {
            el.panel.style.display = 'none';
        }

        function login() {
            if (document.getElementById('pass').value === 'admin123') {
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                updateLists();
                updateStats();
            } else {
                alert('Senha incorreta!');
            }
        }

        function setAlbum(album) {
            state.album = album;
            localStorage.setItem('album', album);
            updateAlbums();
            buildPlaylist();
        }

        function updateAlbums() {
            document.querySelectorAll('.album').forEach(el => {
                el.classList.toggle('active', el.dataset.album === state.album);
            });
        }

        async function upload(type) {
            const files = document.getElementById(type + 'Files').files;
            if (!files.length) return alert('Selecione arquivos');
            
            const btn = event.target;
            btn.classList.add('loading');
            btn.textContent = 'Enviando...';
            
            try {
                for (let file of files) {
                    // Simula√ß√£o (substitua por upload real)
                    const fileObj = {
                        name: file.name,
                        url: URL.createObjectURL(file),
                        date: Date.now()
                    };
                    state.files[type].push(fileObj);
                }
                
                localStorage.setItem(type, JSON.stringify(state.files[type]));
                updateLists();
                buildPlaylist();
                btn.classList.add('success');
                setTimeout(() => btn.classList.remove('success', 'loading'), 1000);
            } catch (e) {
                btn.classList.add('error');
                setTimeout(() => btn.classList.remove('error', 'loading'), 1000);
            }
            
            btn.textContent = 'Upload';
            document.getElementById(type + 'Files').value = '';
        }

        async function uploadAlbum() {
            if (state.album === 'none') return alert('Selecione um √°lbum');
            const files = document.getElementById('albumFiles').files;
            if (!files.length) return alert('Selecione arquivos');
            
            try {
                for (let file of files) {
                    state.files[state.album].push({
                        name: file.name,
                        url: URL.createObjectURL(file),
                        date: Date.now()
                    });
                }
                localStorage.setItem(state.album, JSON.stringify(state.files[state.album]));
                updateLists();
                buildPlaylist();
            } catch (e) {
                alert('Erro no upload');
            }
            document.getElementById('albumFiles').value = '';
        }

        function updateLists() {
            ['music', 'time', 'ads'].forEach(type => updateList(type));
            if (state.album !== 'none') updateAlbumList();
        }

        function updateList(type) {
            const container = document.getElementById(type + 'List');
            container.innerHTML = '';
            state.files[type].forEach((file, i) => {
                const div = document.createElement('div');
                div.className = 'file';
                div.innerHTML = `<span>${file.name}</span><button class="del-btn" onclick="deleteFile('${type}',${i})">üóëÔ∏è</button>`;
                container.appendChild(div);
            });
        }

        function updateAlbumList() {
            const container = document.getElementById('albumList');
            container.innerHTML = '';
            state.files[state.album].forEach((file, i) => {
                const div = document.createElement('div');
                div.className = 'file';
                div.innerHTML = `<span>${file.name}</span><button class="del-btn" onclick="deleteAlbumFile(${i})">üóëÔ∏è</button>`;
                container.appendChild(div);
            });
        }

        function deleteFile(type, index) {
            if (!confirm('Excluir arquivo?')) return;
            state.files[type].splice(index, 1);
            localStorage.setItem(type, JSON.stringify(state.files[type]));
            updateLists();
            buildPlaylist();
        }

        function deleteAlbumFile(index) {
            if (!confirm('Excluir arquivo?')) return;
            state.files[state.album].splice(index, 1);
            localStorage.setItem(state.album, JSON.stringify(state.files[state.album]));
            updateLists();
            buildPlaylist();
        }

        function resetStats() {
            if (!confirm('Resetar estat√≠sticas?')) return;
            state.stats = {};
            localStorage.removeItem('stats');
            updateStats();
        }

        function exportData() {
            const data = {
                files: state.files,
                album: state.album,
                stats: state.stats,
                date: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'radio_backup.json';
            a.click();
        }

        function importData(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = e => {
                try {
                    const data = JSON.parse(e.target.result);
                    state.files = data.files || state.files;
                    state.album = data.album || 'none';
                    state.stats = data.stats || {};
                    
                    // Salvar tudo
                    Object.keys(state.files).forEach(key => {
                        localStorage.setItem(key, JSON.stringify(state.files[key]));
                    });
                    localStorage.setItem('album', state.album);
                    localStorage.setItem('stats', JSON.stringify(state.stats));
                    
                    updateLists();
                    updateAlbums();
                    updateStats();
                    buildPlaylist();
                    alert('Importado com sucesso!');
                } catch (err) {
                    alert('Erro na importa√ß√£o');
                }
            };
            reader.readAsText(file);
        }

        // Controles de teclado
        document.onkeydown = e => {
            if (e.code === 'Space' && !el.panel.style.display) {
                e.preventDefault();
                togglePlay();
            }
        };

        // Wake lock para mobile
        let wakeLock = null;
        el.audio.onplay = async () => {
            try {
                wakeLock = await navigator.wakeLock?.request('screen');
            } catch (e) {}
        };

        // Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(() => {});
        }

        // Inicializar
        init();
    </script>
</body>
</html>
