<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>R√°dio Supermercado do Louro</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-pOdfXW+5pzHqKXMK9v0eZfIuLgR9h0qI1bYb4MOpS6EdGD3T9znZedxosLsdK2NzNmpB3ahMjgrsB/9G4bNfug==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    :root {
      --bg: #1c1c1e;
      --card: #2c2c2e;
      --text: #f2f2f7;
      --accent: #32d74b;
    }
    * {
      margin: 0; padding: 0; box-sizing: border-box;
    }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    h1, h2 {
      color: var(--accent);
    }
    .container {
      display: flex;
      flex-direction: column;
      gap: 30px;
      max-width: 800px;
      margin: auto;
    }
    .card {
      background: var(--card);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    button {
      background: var(--accent);
      color: black;
      padding: 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    input[type="file"] {
      margin-top: 10px;
    }
    .volume-control {
      width: 100%;
      margin-top: 10px;
    }
    #capaAlbum {
      width: 100%;
      border-radius: 12px;
      margin-bottom: 10px;
    }
    #arquivos div {
      display: flex;
      justify-content: space-between;
      margin: 5px 0;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="authCard" class="card">
      <h2>üîí Login do Admin</h2>
      <input type="password" id="senha" placeholder="Digite a senha..." />
      <button onclick="autenticar()">Entrar</button>
    </div>

    <div id="devPanel" class="card hidden">
      <h2>üéõÔ∏è Painel Administrador</h2>
      <div>
        <h3>üéµ Enviar M√∫sica</h3>
        <input type="file" id="musica" />
        <button onclick="upload('musicas', 'musica')">Enviar</button>
      </div>
      <div>
        <h3>üïê Hora Certa</h3>
        <input type="file" id="hora" />
        <button onclick="upload('hora-certa', 'hora')">Enviar</button>
      </div>
      <div>
        <h3>üì¢ Avisos</h3>
        <input type="file" id="aviso" />
        <button onclick="upload('avisos', 'aviso')">Enviar</button>
      </div>
      <div>
        <h3>üñºÔ∏è Imagem do √Ålbum</h3>
        <input type="file" id="imagemAlbum" />
        <button onclick="uploadImagem()">Enviar</button>
      </div>
      <div>
        <h3>üìÇ √Ålbum Ativo: <span id="albumNome">Nenhum</span></h3>
        <button onclick="setAlbum('sao-joao')">S√£o Jo√£o</button>
        <button onclick="setAlbum('natal')">Natal</button>
        <button onclick="setAlbum('pascoa')">P√°scoa</button>
        <button onclick="setAlbum('')">Desativar</button>
      </div>
      <div>
        <h3>üßæ Relat√≥rio</h3>
        <button onclick="resetRelatorio()">Resetar Contagem</button>
        <div id="relatorio"></div>
      </div>
    </div>

    <div class="card">
      <h2>üìª R√°dio Supermercado do Louro</h2>
      <img id="capaAlbum" src="" alt="Capa do √°lbum" />
      <audio id="player" controls onended="proximaMusica()"></audio>
      <input type="range" id="volume" class="volume-control" min="0" max="1" step="0.01" value="1" />
    </div>
  </div>

  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js';
    const supabase = createClient(
      'https://yrlwyvvlgrjbwnoiwdxv.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlybHd5dnZsZ3JqYndub2l3ZHh2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg4MDk0OTMsImV4cCI6MjA2NDM4NTQ5M30.qrNDx8aqL2WtWPalhmjzeUY6bCNVnnK48L2Oi2DpkVI'
    );

    let album = localStorage.getItem('album') || 'musicas';
    let musicas = [];
    let index = 0;
    let tocadas = JSON.parse(localStorage.getItem('relatorio')) || {};

    const player = document.getElementById('player');
    const capa = document.getElementById('capaAlbum');

    async function carregarMusicas() {
      const { data, error } = await supabase.storage.from(album).list();
      if (data) {
        musicas = data.map(f => `https://yrlwyvvlgrjbwnoiwdxv.supabase.co/storage/v1/object/public/${album}/${f.name}`);
        musicas = musicas.sort(() => Math.random() - 0.5);
        tocar();
      }
      exibirCapa();
      atualizarRelatorio();
    }

    function tocar() {
      if (musicas.length === 0) return;
      const src = musicas[index % musicas.length];
      const nome = src.split('/').pop();
      player.src = src;
      tocadas[nome] = (tocadas[nome] || 0) + 1;
      localStorage.setItem('relatorio', JSON.stringify(tocadas));
      atualizarRelatorio();
      player.play();
    }

    function proximaMusica() {
      index++;
      tocar();
    }

    function setAlbum(nome) {
      album = nome || 'musicas';
      localStorage.setItem('album', album);
      document.getElementById('albumNome').textContent = nome || 'Nenhum';
      carregarMusicas();
    }

    function exibirCapa() {
      capa.src = `https://yrlwyvvlgrjbwnoiwdxv.supabase.co/storage/v1/object/public/imagens/${album}.jpg`;
    }

    function atualizarRelatorio() {
      const div = document.getElementById('relatorio');
      div.innerHTML = Object.entries(tocadas).map(([nome, cont]) => `<div>${nome}: ${cont}</div>`).join('');
    }

    function resetRelatorio() {
      tocadas = {};
      localStorage.setItem('relatorio', '{}');
      atualizarRelatorio();
    }

    window.proximaMusica = proximaMusica;
    window.setAlbum = setAlbum;
    window.resetRelatorio = resetRelatorio;

    player.volume = 1;
    document.getElementById('volume').addEventListener('input', e => player.volume = e.target.value);

    async function upload(bucket, inputId) {
      const file = document.getElementById(inputId).files[0];
      if (!file) return alert('Selecione um arquivo');
      await supabase.storage.from(bucket).upload(file.name, file, { upsert: true });
      alert('Arquivo enviado!');
    }

    async function uploadImagem() {
      const file = document.getElementById('imagemAlbum').files[0];
      if (!file || !album) return alert('Selecione o √°lbum e a imagem');
      await supabase.storage.from('imagens').upload(`${album}.jpg`, file, { upsert: true });
      alert('Imagem enviada!');
    }

    window.upload = upload;
    window.uploadImagem = uploadImagem;

    function autenticar() {
      const senha = document.getElementById('senha').value;
      if (senha === '1234') {
        document.getElementById('authCard').classList.add('hidden');
        document.getElementById('devPanel').classList.remove('hidden');
      } else {
        alert('Senha incorreta');
      }
    }
    window.autenticar = autenticar;

    carregarMusicas();
  </script>
</body>
</html>
